---
title: "2. Debugging Tools"
output:
  html_document:
    toc: yes
    toc_depth: '6'
    df_print: paged
  html_notebook: default
  pdf_document:
    toc: yes
    toc_depth: 6
    number_sections: yes
    latex_engine: xelatex
    df_print: kable
    highlight: tango
  word_document:
    toc: yes
    toc_depth: '6'
---

# 2. Debugging Tools

## Debugging Tools - Diagnosing the Problem 

### Something’s Wrong! 


Indications that something’s not right
· message: A generic notification/diagnostic message produced by the message function; execution of the function continues
· warning: An indication that something is wrong but not necessarily fatal; execution of the function continues; generated by the warning function
· error: An indication that a fatal problem has occurred; execution stops; produced by the stop function
· condition: A generic concept for indicating that something unexpected can occur; programmers can create their own conditions



Warning

```{r, error=TRUE}
log(-1)
```

```{r}
printmessage <- function(x) {
  if (x > 0)
    print("x is greater than zero")
  else
    print("x is less than or equal to zero") 
  invisible(x)
}

printmessage(1)
```
The invisible() function in R is used to prevent a value from being automatically printed when a function is called interactively, while still allowing the value to be returned and used in subsequent operations.

```{r, error=TRUE}
printmessage(NA)
```

```{r}
printmessage2 <- function(x) {
  if (is.na(x))
    print("x is a missing value!")
  else if (x > 0)
    print("x is greater than zero")
  else
    print("x is less than or equal to zero")
  invisible(x)
}
```


```{r, error=TRUE}
x <- log(-1)
printmessage2(x)
```

How do you know that something is wrong with your function?
· What was your input? How did you call the function?
· What were you expecting? Output, messages, other results?
· What did you get?
· How does what you get differ from what you were expecting?
· Were your expectations correct in the first place?
· Can you reproduce the problem (exactly)?

## Debugging Tools in R

The primary tools for debugging functions in R are
· *traceback*: prints out the function call stack after an error occurs; does nothing if there’s no error
· *debug*: flags a function for “debug” mode which allows you to step through execution of a function one line at a time
· *browser*: suspends the execution of a function wherever it is called and puts the function in debug mode
· *trace*: allows you to insert debugging code into a function a specific places
· *recover*: allows you to modify the error behavior so that you can browse the function call stack
These are interactive tools specifically designed to allow you to pick through a function. There’s also the more blunt technique of inserting print/cat statements in the function.

## Debugging Tools - Using the Tools

### traceback

```{r, error=TRUE}
mean(x)
```

```{r}
traceback()
```

```{r,error=TRUE}
lm(y~x)
```

```{r}
traceback()
```

## debug

```{r}
debug(lm)
```

```{r,error=TRUE}
lm(y~x)
```

### recover

```{r,error=TRUE}
options(error = error)
read.csv("nosuchfile")
```

### Debugging


Summary
· There are three main indications of a problem/condition: message, warning, error - onlyanerrorisfatal
· When analyzing a function with a problem, make sure you can reproduce the problem, clearly state your expectations and how the output differs from your expectation
· Interactive debugging tools traceback, debug, browser, trace, and recover can be used to find problematic code in functions
· Debugging tools are not a substitute for thinking!


