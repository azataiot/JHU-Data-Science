---
title: "Weekl 2"
output:
  pdf_document:
    toc: yes
    toc_depth: 6
    number_sections: yes
    latex_engine: xelatex
    df_print: kable
    highlight: tango
  html_notebook: default
  html_document:
    toc: yes
    toc_depth: '6'
    df_print: paged
  word_document:
    toc: yes
    toc_depth: '6'
---

# Week 2

## Reading from MySQL

### mySQL 

Free and widely used open source database software
Widely used in internet based applications
Data are structured in
- Databases
- Tables within databases
- Fields within tables
Each row is called a record

### Connecting and listing databases

```{r}
library(RMySQL)
ucscDb <-
  dbConnect(MySQL(), user = "genome", host = "genome-mysql.cse.ucsc.edu")
result <- dbGetQuery(ucscDb, "show databases;")

dbDisconnect(ucscDb)

```

```{r}
result
```

### Connecting to hg19 and listing tables

```{r}
hg19 <- dbConnect(MySQL(),user="genome", db="hg19",host="genome-mysql.cse.ucsc.edu")
allTables <- dbListTables(hg19)
length(allTables)
```

```{r}
allTables[1:5]
```

### Get dimensions of a specific table

```{r}
dbListFields(hg19,"affyU133Plus2")
```

```{r}
dbGetQuery(hg19, "select count(*) from affyU133Plus2")
```

### Read from the table

```{r,error=TRUE}
affyData <- dbReadTable(hg19, "affyU133Plus2")
head(affyData)
```

### Select a specific subset

```{r,error=TRUE}
query<- dbSendQuery(hg19, "select * from affyU133Plus2 where misMatches between 1 and 3")
affyMis <- fetch(query); quantile(affyMis$rnisMatches)
```
```{r,error=TRUE}
affyMisSmall <- fetch(query, n = lO)

dbClearResult(query)
```
```{r,error=TRUE}
dirn(affyMisSmall)
```

### Don't forget to close the connection

```{r}
dbDisconnect(hg19)
```

## Reading from HDF5

### HDFS

Used for storing large data sets
Supports storing a range of data types
Heirarchical data format
groups containing zero or more data sets and metadata
- Have a group header with group name and list of attributes
- Have a group symbol table with a list of objects in group
datasets multidmensional array of data elements with metadata
- Have a headerwith name, datatype, dataspace, and storage layout
- Have a data array with the data
lhttp://www.hdfgroup.org/


### R HDF5 package

```{r}
library(rhdf5)
created <- h5createFile("example.h5")
created
```

### Create groups

```{r}
created <- h5createGroup("example.h5", "foo")
created <- h5createGroup("example.h5", "baa")
created <- h5createGroup("example.h5", "foo/foobaa")
h5ls("example.h5")
```

### Write to groups

```{r}
A <- matrix(1:10,nr=5,nc=2)
h5write(A,"example.h5","foo/A")
B <- array(seq(0.1,2.0,by=0.1),dim = c(5,2,2))
attr(B,"scale") <- "liter"
```

```{r}
h5write(B,"example.h5","foo/foobaa/B")
```


```{r}
h5ls("example.h5")
```


### Write a data set

```{r}
df <- data.frame(1L:5L, seq(0,1,length.out=5),c("ab","cde","fghi","a","s"),stringsAsFactors = FALSE)
```

```{r}
h5write(df,"example.h5","df")
```

```{r}
h5ls("example.h5")
```


### Reading data

```{r}
readA <- h5read("example.h5","foo/A")
readB <- h5read("example.h5","foo/foobaa/B")
readdf <- h5read("example.h5","df")
```

```{r}
readA
```

```{r}
readB
```

```{r}
readdf
```


### Writing and reading chunks

```{r}
h5write(c(12,13,14),"example.h5","foo/A",index=list(1:3,1))
```


```{r}
h5read("example.h5","foo/A")
```











